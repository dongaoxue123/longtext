
<html>
<head>
    <title>Title</title>
    <script src="../../statics/libs/jquery-1.7.2.js"></script>
    <link rel="stylesheet" href="../../statics/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../common/css/cyType.css">
	<link rel="stylesheet" href="../../common/css/extendedStyle.css">
    <link rel="stylesheet" href="../../statics/plugins/layui/css/layui.css" media="all">
    <script src="../../statics/plugins/layui/layui.js"></script>
    <script src="../../common/js/whole/cyLayer.js"></script>
    <script src="../../common/js/whole/utils.js"></script>
    <script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div class="layui-field-box">
    <form class="layui-form" id="form_show">
        <div class="layui-form-item">
        	<label class="layui-form-label layui-required" data-i18n="common.groupName"></label>
			<div class="layui-input-block">
                <input type="text" id="name" name="name" lay-verify="required|name" data-i18n="[placeholder]请输入集团名称，最大长度20" class="layui-input"  maxlength="20" autocomplete="off" >
            </div>
        </div>
        <!-- <div class="layui-form-item">
        	<label class="layui-form-label" data-i18n="[prepend]group.group"> logo</label>
            <div class="layui-input-block">
                <input type="text" id="logo" name="logo"  data-i18n="[placeholder]group.groupLogoPlaceholder" class="layui-input">
            </div>
        </div> -->
        <!--<div class="layui-form-item" style="padding-right: 20px">
             <label class="layui-form-label">集团代码</label>
            <div class="layui-input-inline">
                <input type="text" id="code" name="code" lay-verify="required|code" placeholder="请输入集团代码" class="layui-input">
            </div>
            <label class="layui-form-label StateShow1">状态</label>
            <div class="layui-input-inline StateShow2">
                <select id="state" name="state" style="height: 38px;border-color: #F0F0F0;">
		        	<option value="0">可用</option>
		        	<option value="1">不可用</option>
		    	</select>
            </div>
        </div>-->
        <div class="layui-form-item" style="padding-right: 20px">
            <!-- <label class="layui-form-label" data-i18n="group.groupDescription"></label> -->
			<label class="layui-form-label" data-i18n="common.remark"></label>
            <div class="layui-input-block">
		      <textarea id="remark" name="remark" data-i18n="[placeholder]house.remarkPlaceholder" class="layui-textarea" maxlength="100" autocomplete="off" ></textarea>
		     <!--    <textarea id="remark" name="remark" data-i18n="[placeholder]house.remarkPlaceholder" class="layui-textarea"></textarea>  -->
		    </div>
        </div>
        <div class="page-footer">
            <div class="btn-list">
                <div class="btnlist">
                    <button class="layui-btn" lay-submit="" lay-filter="submit" data-i18n="[append]btnSave"><i class="fa fa-floppy-o">&nbsp;</i></button>
                    <button class="layui-btn" onclick="$t.closeWindow();" data-i18n="[append]btnBack"><i class="fa fa-undo">&nbsp;</i></button>
                </div>
            </div>
        </div>
    </form>
</div>
<!-- 国际化        -->
	<script src="../../statics/plugins/i18n/i18next.min.js"></script>
	<script src="../../statics/plugins/i18n/i18nextXHRBackend.min.js"></script>
	<script src='../../statics/plugins/i18n/loc-i18next.min.js'></script>
<script>
	var authToken=localStorage.getItem("authToken");
 i18n('../../locales', onLangReady) //国际化
		function onLangReady() {
			
	
    layui.use(['form','laydate','element'], function(){
        var form = layui.form;
        var $ = layui.$;
		var element = layui.element;
		
		if(!checkToken()){
  			alert(i18next.t("timeout"));
 			window.top.location.href = '../../login.html';
		}
		
		var groupId = GetQueryString("id");//groupId为空表示新增，否则是修改
        if(groupId != null){
        	$.ajax({
				type: "GET",
				url: commonIP + 'api/system/group/getListPage?authToken='+authToken+'&page=0&limit=0&id='+groupId,
				parseData: function(res){ //res 即为原始返回的数据
			    return {
			    "code": res.code, //解析接口状态
      			"msg": res.msg, //解析提示文本
      			"count": res.count, //解析数据长度
			    "data": res.dataSource.list //解析数据列表
			    };
  			   },
				contentType: 'application/json',
				success: function(data) {
					var datas = JSON.parse(data);
					console.log(datas);
					if (datas.errcode == 200) {	
						$("#name").val(datas.dataSource.list[0].name);
						$("#code").val(datas.dataSource.list[0].code);
						$("#logo").val(datas.dataSource.list[0].logo);
						$("#remark").val(datas.dataSource.list[0].remark);
					} else {
						alert(data.errmsg);
						if(data.errcode=="10005"){
								window.top.location.href = '../../login.html';
						}
					}
				}
			});
        }
        //监听提交
        if(groupId == null)//添加
		{
	        form.on('submit(submit)', function(res){
				console.log(res)
		        //layer.msg(JSON.stringify(res.field));
	       		$.ajax({
	                type: 'POST',
					url: commonIP + "api/system/group/create?authToken="+authToken,
					contentType: 'application/json',
					data: JSON.stringify(res.field),
					async: false,
					success: function(data) {
						var dataObj = JSON.parse(data);
						if (dataObj) {
							if (dataObj.errcode == "200") {
							    alert(i18next.t("addSucc"));
		                        layer.close(layer.index);  
		                        window.parent.location.reload();  
							} else {
							 	alert(dataObj.errmsg);
							}
						}
					}
	            });
            	return false;
           });
        }
		else //编辑
		{		
			form.on('submit(submit)', function(res){
	        //layer.msg(JSON.stringify(res.field));
	       		$.ajax({  
	                type: 'POST',
					url: commonIP + "api/system/group/update?authToken="+authToken,
					contentType: 'application/json',
					data: JSON.stringify({
							"id":groupId,
							"name":res.field.name,
							"code":res.field.code,
							"logo":res.field.logo,
							"remark":res.field.remark,
						}) ,
					async: false,
					success: function(data) {
						var dataObj = JSON.parse(data);
						if (dataObj) {
							if (dataObj.errcode == "200") {
							    alert(i18next.t("updateSucc"));
		                        layer.close(layer.index);  
		                        window.parent.location.reload();  
							} else {
							 	alert(dataObj.errmsg);
							 	
							}
						}
					}
	            });
            	return false;
          	});
		}
    });
	}
</script>
</body>
</html>
