
<html>
<head>
    <title>Title</title>
    <script src="../../statics/libs/jquery-1.7.2.js"></script>
    <link rel="stylesheet" href="../../statics/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../common/css/cyType.css">
	<link rel="stylesheet" href="../../common/css/extendedStyle.css">
    <link rel="stylesheet" href="../../statics/plugins/layui/css/layui.css" media="all">
    <script src="../../statics/plugins/layui/layui.js"></script>
    <script src="../../common/js/whole/cyLayer.js"></script>
    <script src="../../common/js/whole/utils.js"></script>
    <script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-1.8.2.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div class="layui-field-box">
    <form class="layui-form">
        <div class="layui-form-item" style="padding-right: 20px">
        	<label class="layui-form-label layui-required" data-i18n="device.deviceMarkName"></label>
            <div class="layui-input-inline">
                <input type="text" autocomplete="off" id="code" data-i18n="[placeholder]device.deviceMarkName" name="code" lay-verify="required|code" class="layui-input">
            </div>
          <!--  <label class="layui-form-label" data-i18n="device.serverAddress"></label>
            <div class="layui-input-inline">
                <input type="text" id="serverAddress" name="serverAddress" lay-verify="required|serverAddress" class="layui-input">
            </div> -->
        </div>
        <div class="layui-form-item" style="padding-right: 20px">
        	<label class="layui-form-label layui-required" data-i18n="device.lowerBatteryLimit"></label>
            <div class="layui-input-inline">
                <input type="text"   autocomplete="off"id="batteryLimit" data-i18n="[placeholder]device.lowerBatteryLimit" name="batteryLimit" lay-verify="required|batteryLimit" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="padding-right: 20px">
        	<label class="layui-form-label layui-required" data-i18n="device.collectingPictures"></label>
            <div class="layui-input-inline">
                <input type="text" autocomplete="off" id="photograph" name="photograph" data-i18n="[placeholder]device.collectingPictures" lay-verify="required|photograph" class="layui-input">
            </div>
            <!-- <label class="layui-form-label" data-i18n="device.effectiveTime"></label>
            <div class="layui-input-inline">
                <input type="text" id="validTime" name="validTime" lay-verify="required|validTime" class="layui-input">
            </div> -->
        </div>
        <!--<div class="layui-form-item" style="padding-right: 20px">
        	<label class="layui-form-label" data-i18n="device.applicationIdentifier"></label>
            <div class="layui-input-inline">
                <input type="text" id="identifier" name="identifier" lay-verify="required|identifier" class="layui-input">
            </div>
            <label class="layui-form-label" data-i18n="device.speedSetting"></label>
            <div class="layui-input-inline">
                <input type="text" id="speedSetting" name="speedSetting" lay-verify="required|speedSetting" class="layui-input">
            </div>
        </div>-->
        <div class="layui-form-item" style="padding-right: 20px">
        	<!-- <label class="layui-form-label" data-i18n="device.waitingTime"></label>
            <div class="layui-input-inline">
                <input type="text" id="waitTime" name="waitTime" lay-verify="required|waitTime" class="layui-input">
            </div> -->
            <label class="layui-form-label layui-required" >rfid</label>
            <div class="layui-input-inline">
                <input type="text" autocomplete="off" id="rfid" name="rfid" data-i18n="[placeholder]rfid" lay-verify="required|rfid" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="padding-right: 20px">
        	<!-- <label class="layui-form-label">启动时间间隔</label>
            <div class="layui-input-inline">
                <input type="text" id="intervalTime" name="intervalTime" class="layui-input">
            </div> -->
            <label class="layui-form-label layui-required" data-i18n="device.startTime"></label>
            <div class="layui-input-inline">
                <input type="text" autocomplete="off" id="autoExecuteTime" name="autoExecuteTime" data-i18n="[placeholder]device.startTime" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="padding-right: 20px">
			<label class="layui-form-label layui-required" data-i18n="device.residenceTime"></label>
			<div class="layui-input-inline">
			    <input type="text" autocomplete="off"  id="stopTime" name="stopTime" data-i18n="[placeholder]device.residenceTime" lay-verify="required|stopTime" class="layui-input">
			</div>
        	<!-- <label class="layui-form-label">选择时间</label>
			<div class="layui-input-inline">
                <input type="text" id="chooseTime" name="chooseTime" class="layui-input" disabled="disabled">
            </div>
            <label class="layui-form-label"></label>
            <div class="layui-input-inline">
             <div class="layui-inline" id="tense"></div>
            </div> -->
        </div>
		<div class="layui-form-item" style="padding-right: 20px">
			<label class="layui-form-label layui-required" data-i18n="device.liveAddress"></label>
			<div class="layui-input-inline">
			    <input type="text" autocomplete="off"  id="liveAddress" name="liveAddress" data-i18n="[placeholder]device.liveAddress" lay-verify="required|liveAddress" class="layui-input">
			</div>
        </div>
        <div class="layui-form-item" style="padding-right: 20px">
			<label class="layui-form-label layui-required" data-i18n="device.trackNo"></label>
			<div class="layui-input-inline">
			    <input type="text" autocomplete="off"  id="trackNo" name="trackNo" data-i18n="[placeholder]device.trackNo" lay-verify="required|trackNo" class="layui-input">
			</div>
        </div>
        <div class="page-footer">
            <div class="btn-list">
                <div class="btnlist">
                    <button class="layui-btn" lay-submit="" lay-filter="submit" data-i18n="[append]btnSave"><i class="fa fa-floppy-o">&nbsp;</i></button>
                    <button class="layui-btn" onclick="$t.closeWindow();" data-i18n="[append]btnBack"><i class="fa fa-undo">&nbsp;</i></button>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- 国际化        -->
	<script src="../../statics/plugins/i18n/i18next.min.js"></script>
	<script src="../../statics/plugins/i18n/i18nextXHRBackend.min.js"></script>
	<script src='../../statics/plugins/i18n/loc-i18next.min.js'></script>
<script>
	var authToken=localStorage.getItem("authToken");
	//alert(authToken);
	var user =localStorage.getItem("user");
 i18n('../../locales', onLangReady) //国际化
		function onLangReady() {
    layui.use(['form','laydate'], function(){
        var form = layui.form;
        var laydate = layui.laydate;
        var $ = layui.$;
          //时间选择器
//		laydate.render({
//		    elem: '#tense'
//		    ,type: 'time'
//		    ,position: 'static'
//		    ,done: function(value, date, endDate){
//		    	var input = document.getElementById("chooseTime");
//		    	if(input.value != ""){
//			    	var time = input.value + "," + value.substring(0,5)	
//			    		$("#chooseTime").attr("value",time);
//		    	}
//		    	else {
//		    	  $("#chooseTime").attr("value",value.substring(0,5));
//		    	}
//	         }
//		  });
		if(!checkToken()){
  			alert(i18next.t("timeout"));
 			window.top.location.href = '../../login.html';
		}
		BindUpdateList()
		form.on('submit(submit)', function(res){
    	$.ajax({
		type: "POST",
		url: commonIP + 'api/xlqx/mq/sendConfigMsg?authToken='+authToken,
		contentType: 'application/json',
		data: JSON.stringify({
				"userid":"",
				"code":res.field.code,
				"serverAddress":res.field.serverAddress,
				"batteryLimit":res.field.batteryLimit,
				"stopTime":res.field.stopTime,
				"photograph":res.field.photograph,
				"validTime":res.field.validTime,
				"identifier":res.field.identifier,
				"speedSetting":res.field.speedSetting,
				"waitTime":res.field.waitTime,
				"rfid":res.field.rfid,
				"autoExecuteTime":res.field.autoExecuteTime,
				"state":res.field.state,
				"liveAddress":res.field.liveAddress,
				"trackNo":res.field.trackNo
			}) ,
		async: false,
		success: function(data) {
//				if (data == "success") {
//			     alert("i18next.n("device.sendSucc")");
                 alert("配置成功！");
                 layer.close(layer.index);  
                 window.parent.location.reload();  
//				} else {
//	             layer.close(layer.index);  
//               window.parent.location.reload();  
//				}
		}
		});
		return false;
      });
      
      
	    function BindUpdateList(){
	    	$.ajax({
			type: "GET",
			url: commonIP + 'api/system/deviceExcute/getListPage?authToken='+authToken+'&page=0&limit=0&code='+GetQueryString("code"),
			parseData: function(res){ //res 即为原始返回的数据
			    return {
			    	"code": res.code, //解析接口状态
      			"msg": res.msg, //解析提示文本
      			"count": res.count, //解析数据长度
			      "data": res.dataSource.list //解析数据列表
			    };
  			},
			contentType: 'application/json',
			success: function(data) {
				var datas = JSON.parse(data);
				console.log(datas);
				if (datas.errcode == 200) {
					//赋值
					$("#state").val(datas.dataSource.list[0].state);
					form.render('select');
					$("#code").val(datas.dataSource.list[0].code);
					$("#serverAddress").val(datas.dataSource.list[0].serverAddress);
					$("#batteryLimit").val(datas.dataSource.list[0].batteryLimit);
					$("#stopTime").val(datas.dataSource.list[0].stopTime);
					$("#photograph").val(datas.dataSource.list[0].photograph);
					$("#validTime").val(datas.dataSource.list[0].validTime);
					$("#identifier").val(datas.dataSource.list[0].identifier);
					$("#speedSetting").val(datas.dataSource.list[0].speedSetting);
					$("#waitTime").val(datas.dataSource.list[0].waitTime);
					$("#rfid").val(datas.dataSource.list[0].rfid);
					$("#autoExecuteTime").val(datas.dataSource.list[0].autoExecuteTime);
					$("#liveAddress").val(datas.dataSource.list[0].liveAddress);
					$("#trackNo").val(datas.dataSource.list[0].trackNo);
				} else {
					if(data.errcode=="10005"){
							window.top.location.href = '../../login.html';
					}
				}
			}
			});   
        }
    });
    }
	
	function GetQueryString(name)
	{
	     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	     var r = window.location.search.substr(1).match(reg);
	     if(r!=null)return  unescape(r[2]); return null;
	}

</script>
</body>
</html>
