<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>守望者设备详细信息</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="../../statics/plugins/layui/css/layui.css" media="all">

	</head>
	<script src="../../statics/plugins/layui/layui.js"></script>
	<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../statics/libs/jquery-1.7.2.js"></script>
	<body>
		<!--<div>
			<tr>
				<td id="code">
					设备编号：
					<label id="lbl1" ></label>
				</td>
			</tr>
		</div>
		<div>
			<tr>
				<td id="state">
					当前状态：
					<label id="lbl2" ></label>
				</td>
			</tr>
		</div>-->
		<div style="text-align: center;color: #999;margin-top: 10px;" id="errtext"></div>
		<div id="round">	
		<!--<button class="layui-btn" id="foreward" data-i18n="device.foreward"></button>
		<button class="layui-btn" id="pause" data-i18n="device.pause"></button>
		<button class="layui-btn" id="backward" data-i18n="device.backward"></button>
		<button class="layui-btn" id="go" data-i18n="device.go"></button>
		<button class="layui-btn" id="stop" data-i18n="device.stop"></button>
		<button class="layui-btn" id="back" data-i18n="device.back"></button>
		</div>
		<div style="margin: 10px;">
		  <button class="layui-btn" id="openDeepCamera" data-i18n='device.startDeep'></button>
		  <button class="layui-btn" id="closeDeepCamera" data-i18n='device.closeDeep'></button>
		</div>
		<div style="margin: 10px;">
		  <button class="layui-btn" id="openCamera" data-i18n='device.startCheck'></button>
		  <button class="layui-btn" id="closeCamera" data-i18n='device.closeCheck'></button>
		</div>
		<div style="margin: 10px;">
		  <button class="layui-btn" id="startUploadPicture" data-i18n='device.startUpload'></button>
		  <button class="layui-btn" id="endUploadPicture" data-i18n='device.stopUpload'></button>
		</div>-->
		
		<table class="layui-hide" id="deviceInfo" lay-filter="deviceInfo"></table>
		</div>
		<!-- 国际化        -->
	<script src="../../statics/plugins/i18n/i18next.min.js"></script>
	<script src="../../statics/plugins/i18n/i18nextXHRBackend.min.js"></script>
	<script src='../../statics/plugins/i18n/loc-i18next.min.js'></script>
		<script type="text/javascript">
			var authToken = localStorage.getItem("authToken");
			var user = localStorage.getItem("user");
			$("#round").css("display","block");
			i18n('../../locales', onLangReady) //国际化
			
			function selectRetInfo() { 	
				$.ajax({
					type: "GET",
					url: commonIP + 'api/system/device/selectRetInfo?code='+GetQueryString("code"),
					contentType: 'application/json',
					data: 'authToken=' + authToken,
					dataType: 'json', // GET 请求方式需要添加dataType 设定返回数据的格式为json;
					async:false,
					success: function(result) {
						console.log(result);
						$("#lbl1").text(result.dataSource.list[0].code);
						$("#lbl2").text(result.dataSource.list[0].currentState);
					}
				});
			}
			
		function onLangReady() {
			if(!checkToken()) {
				alert(i18next.t("timeout"));
				window.top.location.href = '../../login.html';
			}
			//selectRetInfo();
		     //setInterval("selectRetInfo()", 1000*5);//5秒查询一次设备状态
		     
		     
		     
			layui.use(['form', 'table', 'laydate'], function() {
				var table = layui.table;
				var form = layui.form;
				var laydate = layui.laydate;
				var $ = layui.$;
				table.render({
					elem: '#deviceInfo',
					url: commonIP + "api/system/device/getDetailPage?authToken=" + authToken + '&page=0&limit=0&code=' + GetQueryString("code") //数据请求路径
						,
					parseData: function(res) { //res 即为原始返回的数据
						var errJson;
						if(res.errcode == 500){
							$("#round").css("display","none");
						var text ="<div>没有详细说明</div>"
						$("#errtext").html(text);
						}else{
							$("#round").css("display","block");
							return {
								"code": 0, //解析接口状态
								"msg": '', //解析提示文本
								"count": 1, //解析数据长度
								"data": parseCol(res) //解析数据列表
							};
						}
					},
					cellMinWidth: 80,
					cols: [
						[	{
								field: 'name',
								title: i18next.t("common.farmName") ,
								width: '30%'
							}, {
								field: 'value',
								title: i18next.t("common.farmName") ,
								width: '30%'
							}
						]
					],
					done: function(res, curr, count){
//						console.log(new Date())
						$('th').hide();//表头隐藏的样式
					},
					even: true //开启隔行背景
						,
					page: false //开启分页
						,
					limit: 20 //默认十条数据一页
						,
					limits: [10, 20, 30, 50] //数据分页条
						,
					id: 'testReload'
				});
				
				//定时刷新表格
				/*timer = setInterval(function(){tableReload()}, 6000)
				function tableReload(){
					table.reload("testReload")
				}*/
				
				//表格列转换
				$("#round").css("display","block");

				function parseCol(data){
					let aDatas = new Array()
					for(let key in data){
						aDatas.push({name: key, value: data[key]})
					}
					return aDatas;
				}
				
				//发送命令
				function sendOrder(control, collection) {
					let param = getOrderParam(control, collection)
					$.ajax({
						url: commonIP + 'api/xlqx/fanout/fanoutSendMsg?msg="' +  param + '"',
						parseData: function(res) { //res 即为原始返回的数据
							return {
								"code": res.code, //解析接口状态
								"msg": res.msg, //解析提示文本
								"count": res.count, //解析数据长度
								"data": res.dataSource.list //解析数据列表
							};
						},
						success: function(res) {
						}
					});
				}
				//发送上传命令
				function sendUploadOrder(control) {
					$.ajax({
						url: commonIP + 'api/xlqx/fanout/fanoutSendMsg?msg="' +  control + '"',
						parseData: function(res) { //res 即为原始返回的数据
							return {
								"code": res.code, //解析接口状态
								"msg": res.msg, //解析提示文本
								"count": res.count, //解析数据长度
								"data": res.dataSource.list //解析数据列表
							};
						},
						success: function(res) {
						}
					});
				}
				function getOrderParam(control, collection){
					return 'code:' + GetQueryString("code") + ',control:' + control + ',collection:' + collection;
				}
				
				//向前
				$('#foreward').on('click', function() {
					let YN = confirm(i18next.t("device.sendConfirm") + i18next.t("device.foreward") + i18next.t("device.collectionOrder"))
					if(YN){
						sendOrder(1, 1);
					}
				});
				//暂停
				$('#pause').on('click', function() {
					let YN = confirm(i18next.t("device.sendConfirm") + i18next.t("device.pause") + i18next.t("device.collectionOrder"))
					if(YN){
						sendOrder(0, 1);
					}
				});
				//向后
				$('#backward').on('click', function() {
					let YN = confirm(i18next.t("device.sendConfirm") + i18next.t("device.backward") + i18next.t("device.collectionOrder"))
					if(YN){
						sendOrder(2, 1);
					}
				});
				//前进
				$('#go').on('click', function() {
					let YN = confirm(i18next.t("device.sendConfirm") + i18next.t("device.go") + i18next.t("device.order"))
					if(YN){
						sendOrder(1, 0);
					}
				});
				//停止
				$('#stop').on('click', function() {
					let YN = confirm(i18next.t("device.sendConfirm") + i18next.t("device.stop") + i18next.t("device.order"))
					if(YN){
						sendOrder(0, 0);
					}
				});
				//后退
				$('#back').on('click', function() {
					let YN = confirm(i18next.t("device.sendConfirm") + i18next.t("device.back") + i18next.t("device.order"))
					if(YN){
						sendOrder(2, 0);
					}
				});
				//开始上传图片
				$('#startUploadPicture').on('click', function() {
					let YN = confirm(i18next.t("device.startUploadConfirm"))
					if(YN){
						sendUploadOrder("start");
					}
				});
				//停止上传图片
				$('#endUploadPicture').on('click', function() {
					let YN = confirm(i18next.t("device.endUploadConfirm"))
					if(YN){
						sendUploadOrder("end");
					}
				});
			})
		}
		</script>
	</body>

</html>