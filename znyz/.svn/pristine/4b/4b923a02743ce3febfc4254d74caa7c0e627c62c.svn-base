
<html>
<head>
    <script src="../../statics/libs/jquery-1.7.2.js"></script>
    <link rel="stylesheet" href="../../statics/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../common/css/cyType.css">
	<link rel="stylesheet" href="../../common/css/extendedStyle.css">
    <link rel="stylesheet" href="../../statics/plugins/layui/css/layui.css" media="all">
    <script src="../../statics/plugins/layui/layui.js"></script>
    <script src="../../common/js/whole/cyLayer.js"></script>
    <script src="../../common/js/whole/utils.js"></script>
    <script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
	
</head>
<body>
<div class="layui-field-box" id="area-picker">
    <form class="layui-form">
        <div class="layui-form-item">
        	<label class="layui-form-label layui-required" data-i18n="common.groupName"></label>
            <div class="layui-input-inline">
                <select id="groupId" name="groupId" lay-verify="required">
		        	<option value="" data-i18n="farm.groupValDefault"></option>
		    	</select>
            </div>
            <label class="layui-form-label layui-required" data-i18n="farm.type"></label>
            <div class="layui-input-inline">
               	<select id="type" name="type" style="height: 38px;border-color: #F0F0F0;">
		        	<option value="" data-i18n="farm.farmTypeValDefault"></option>
		        	<option value="0">种猪场</option>
		        	<option value="1">肥猪场</option>
		        	
		    	</select>
            </div>
        </div>
        <div class="layui-form-item">
            <!--<label class="layui-form-label">猪场代码</label>
            <div class="layui-input-inline">
                <input type="text" id="code" name="code" lay-verify="required|code" class="layui-input">
            </div>-->
            <label class="layui-form-label layui-required" data-i18n="common.farmName" ></label>
            <div class="layui-input-inline">
                <input type="text" id="name" name="name" lay-verify="required|name" class="layui-input"  data-i18n="[placeholder]common.farmNameText" autocomplete="off" maxlength="10" >
            </div>
            <label class="layui-form-label" data-i18n="farm.scale"></label>
            <div class="layui-input-inline">
				
				<select id="scale" name="scale" style="height: 38px;border-color: #F0F0F0;">
					<option value="" data-i18n=""></option>
					<option value="0"> 小型(母猪存栏：小于500头/肥猪存栏:2000头)</option>
					<option value="1"> 中型(母猪存栏：500~2000头/肥猪存栏:10000头)</option>
					<option value="2"> 大型(母猪存栏：大于2000头/肥猪存栏:40000头)</option>
				</select>
                <!-- <input type="text" id="scale" name="scale" class="layui-input" data-i18n="[placeholder]farm.farmScalePlaceholder" maxlength="1"> -->
            </div>
        </div>
        <div class="layui-form-item">
            <!--<label class="layui-form-label">集团关联猪场ID</label>
            <div class="layui-input-inline">
                <input type="text" id="farmIdLink" name="farmIdLink" class="layui-input">
            </div>-->
            <label class="layui-form-label" data-i18n="farm.farmRegion"></label>
            <div class="layui-input-inline">
				<select id="area" name="area" style="height: 38px;border-color: #F0F0F0;">
					<option value="" data-i18n=""></option>
					<option value="0"> 华中地区</option>
					<option value="1"> 华北地区</option>
					<option value="2"> 华东地区</option>
					<option value="3"> 华南地区</option>
					<option value="4"> 西北地区</option>
					<option value="5"> 东北地区</option>
					<option value="6"> 西南地区</option>
				</select>
                <!-- <input type="text" id="area" name="area" class="layui-input"  data-i18n="[placeholder]farm.farmRegionText" maxlength="10" autocomplete="off" > -->
            </div>
            <label class="layui-form-label" data-i18n="common.province"></label>
            <div class="layui-input-inline">
                <!-- <input type="text" id="province" name="province"  data-i18n="[placeholder]common.province" class="layui-input"> -->
				
                <select id="province" name="province"   class="province-selector"  data-i18n="[placeholder]common.province" lay-filter="province-1|province" lay-search >
				    <option value=" "> </option>
				</select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" data-i18n="common.city"></label>
            <div class="layui-input-inline">
<!--                <input type="text" id="city" name="city"  data-i18n="[placeholder]common.city" class="layui-input">-->		
				
				
                <select  id="city" name="city" class="city-selector" data-i18n="[placeholder]common.city"lay-filter="city-1" lay-search>
					<option value=" "> </option>
				</select>
            </div>
            <label class="layui-form-label" data-i18n="common.county"></label>
            <div class="layui-input-inline">
                <!-- <input type="text" id="county" name="county"  data-i18n="[placeholder]common.county" class="layui-input"> -->
				<select id="county" name="county" class="county-selector" data-i18n="[placeholder]common.county" lay-filter="county-1" lay-search>
				    <option value=" "> </option>
				</select>
				
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" data-i18n="common.Zip"></label>
            <div class="layui-input-inline">
                <input type="text" id="postcode" name="postcode" class="layui-input"  maxlength="6" oninput = "value=value.replace(/[^\d]/g,'')" data-i18n="[placeholder]common.Zip">
            </div>
            <label class="layui-form-label" data-i18n="common.telphone"></label>
            <div class="layui-input-inline">
                <input type="text" id="phone" name="phone" class="layui-input phone-reg" maxlength="11" oninput = "value=value.replace(/[^\d]/g,'')"   data-i18n="[placeholder]common.telphone" autocomplete="off" >
            </div>
        </div>
        <!--<div class="layui-form-item">
            <label class="layui-form-label" data-i18n="common.fax"></label>
            <div class="layui-input-inline">
                <input type="text" id="fax" name="fax" class="layui-input" data-i18n="[placeholder]common.fax">
            </div>
            <label class="layui-form-label" data-i18n="farm.geographic"></label>
            <div class="layui-input-inline">
                <input type="text" id="geographicInfo" name="geographicInfo" class="layui-input" data-i18n="[placeholder]farm.geographic">
            </div>
        </div>
        -->
        
             <!--<div class="layui-form-item">
            <label class="layui-form-label" data-i18n="farm.longitude"></label>
            <div class="layui-input-inline">
                <input type="text" id="longitude" name="longitude" class="layui-input" data-i18n="[placeholder]farm.longitude">
            </div>
            <label class="layui-form-label" data-i18n="farm.latitude"></label>
            <div class="layui-input-inline">
                <input type="text" id="latitude" name="latitude" class="layui-input" data-i18n="[placeholder]farm.latitude">
            </div>
        </div>-->

        <!--<div class="layui-form-item">
            <label class="layui-form-label StateShow1">状态</label>
            <div class="layui-input-inline StateShow2">
                <select id="state" name="state" style="height: 38px;border-color: #F0F0F0;">
		        	<option value="0">可用</option>
		        	<option value="1">不可用</option>
		    	</select>
            </div>
        </div>-->
        <div class="layui-form-item">
            <label class="layui-form-label" data-i18n="farm.address"></label>
            <div class="layui-input-block">
                <input type="text" id="address" name="address" class="layui-input" data-i18n="[placeholder]farm.detailedAddressText" autocomplete="off" maxlength="50">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" data-i18n="common.remark"></label>
            <div class="layui-input-block">
                <textarea id="remark" name="remark" data-i18n="[placeholder]house.remarkPlaceholder"  class="layui-textarea" maxlength="100" ></textarea>
            </div>
        </div>
        <div class="page-footer">
            <div class="btn-list">
                <div class="btnlist">
                    <button class="layui-btn" lay-submit="" lay-filter="submit" data-i18n="[append]btnSave"><i class="fa fa-floppy-o">&nbsp;</i></button>
                    <button class="layui-btn" onclick="$t.closeWindow();" data-i18n="[append]btnBack"><i class="fa fa-undo">&nbsp;</i></button>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- 国际化        -->
	<script src="../../statics/plugins/i18n/i18next.min.js"></script>
	<script src="../../statics/plugins/i18n/i18nextXHRBackend.min.js"></script>
	<script src='../../statics/plugins/i18n/loc-i18next.min.js'></script>

<script>
	var authToken=localStorage.getItem("authToken");
	//alert(authToken);
	var user =localStorage.getItem("user");
	 //配置插件目录
	layui.config({
		base: '../../mods/'
		, version: '1.0'
	});
	i18n('../../locales', onLangReady) //国际化
	function onLangReady() {
    layui.use(['layer','form','laydate','layarea'], function(){
        var layer = layui.layer
		,layarea = layui.layarea;
		var form = layui.form;
        var $ = layui.$
		,pca = layui.pca;
		render();
		
		function render(){
         layarea.render({
            elem: '#area-picker',
            change: function (res) {
            //选择结果
            console.log(res);
          }
        });
		}
		
		if(!checkToken()){
  			alert(i18next.t("timeout"));
 			window.top.location.href = '../../login.html';
		}
		
		//获取集团下拉列表
	   	$.ajax({
	        url: commonIP + 'api/system/group/getListPage?authToken='+authToken+'&page=0&limit=0',
	        parseData: function(res){ //res 即为原始返回的数据
			    return {
			    "code": res.code, //解析接口状态
      			"msg": res.msg, //解析提示文本
      			"count": res.count, //解析数据长度
			    "data": res.dataSource.list //解析数据列表
			    };
  			},
	        success: function (res) {
	    	var dataObj = JSON.parse(res);
		    if(dataObj!=null && dataObj.dataSource.list.length>0){
	            var groupOption;
	            for (var i = 0; i < dataObj.dataSource.list.length; i++) {
	            	groupOption = groupOption+'<option value="'+dataObj.dataSource.list[i].id+'">'+dataObj.dataSource.list[i].name+'</option>';
	            }
	            $("#groupId").append(groupOption);
	            form.render('select');//一定要加form.render();
	            BindUpdateList();
	    	  }
	    }
	    }); 
	    
	
		var userId = GetQueryString("id");//userId为空表示新增，否则是修改
		
		function BindUpdateList(){
        if(userId != null){
        	$.ajax({
				type: "GET",
				url: commonIP + 'api/system/farm/getListPage?authToken='+authToken+'&page=0&limit=0&id='+userId,
				parseData: function(res){ //res 即为原始返回的数据
			    return {
			    "code": res.code, //解析接口状态
      			"msg": res.msg, //解析提示文本
      			"count": res.count, //解析数据长度
			    "data": res.dataSource.list //解析数据列表
			    };
  			    },
				contentType: 'application/json',
				success: function(data) {
//					$(".StateShow1").css("display","block");
//                  $(".StateShow2").css("display","block");
					var datas = JSON.parse(data);
					console.log(datas);
					if (datas.errcode == 200) {	
						render();
						
						//alert(datas.dataSource.list[0].province);
						$("#groupId").val(datas.dataSource.list[0].groupId);
						$("#type").val(datas.dataSource.list[0].type);
						// form.render('select');
						$("#name").val(datas.dataSource.list[0].name);
						$("#code").val(datas.dataSource.list[0].code);
						$("#farmIdLink").val(datas.dataSource.list[0].farmIdLink);
						$("#area").val(datas.dataSource.list[0].area);
						form.render('select');
						$("#scale").val(datas.dataSource.list[0].scale);
						
						$("#province").val(datas.dataSource.list[0].province);
						form.render('select');
						$("#city").val(datas.dataSource.list[0].city);
						$("#county").val(datas.dataSource.list[0].county);
						form.render('select');
						$("#address").val(datas.dataSource.list[0].address);
						$("#postcode").val(datas.dataSource.list[0].postcode);
						$("#phone").val(datas.dataSource.list[0].phone);
						$("#fax").val(datas.dataSource.list[0].fax);
						$("#geographicInfo").val(datas.dataSource.list[0].geographicInfo);
						$("#remark").val(datas.dataSource.list[0].remark);
						$("#longitude").val(datas.dataSource.list[0].longitude);
						$("#latitude").val(datas.dataSource.list[0].latitude);
						form.render();
					} else {
						alert(data.errmsg);
						if(data.errcode=="10005"){
								window.top.location.href = '../../login.html';
						}
					}
				}
			});
        }
        }
        //监听提交
        if(userId == null){//添加
	        form.on('submit(submit)', function(res){
				console.log("fdafa"+JSON.stringify(res))
		        //layer.msg(JSON.stringify(res.field));
	       		$.ajax({  
	                type: 'POST',
					url: commonIP + "api/system/farm/create?authToken="+authToken,
					contentType: 'application/json',
					data: JSON.stringify(res.field),
					async: false,
					success: function(data) {
						var dataObj = JSON.parse(data);
	//					console.log(dataObj);
	//					console.log(dataObj.errcode);
						if (dataObj) {
							if (dataObj.errcode == "200") {
							    alert(i18next.t("addSucc"));
		                        layer.close(layer.index);  
		                        window.parent.location.reload();  
							} else {
							 	alert(dataObj.errmsg);
							}
						}
					}
	            }); 
            	return false;
           	});
        }else{//编辑		
			form.on('submit(submit)', function(res){
		        //layer.msg(JSON.stringify(res.field));
	       		$.ajax({  
	                type: 'POST',
					url: commonIP + "api/system/farm/update?authToken="+authToken,
					contentType: 'application/json',
					data: JSON.stringify({
							"id":userId,
							"name":res.field.name,
							"code":res.field.code,
							"groupId":res.field.groupId,
							"type":res.field.type,
							"farmIdLink":res.field.farmIdLink,
							"area":res.field.area,
							"scale":res.field.scale,
							"province":res.field.province,
							"city":res.field.city,
							"county":res.field.county,
							"address":res.field.address,
							"postcode":res.field.postcode,
							"phone":res.field.phone,
							"fax":res.field.fax,
							"geographicInfo":res.field.geographicInfo,
							"remark":res.field.remark,
							"latitude":res.field.latitude,
							"longitude":res.field.longitude,
						}) ,
					async: false,
					success: function(data) {
						var dataObj = JSON.parse(data);
						if (dataObj) {
							if (dataObj.errcode == "200") {
							    alert(i18next.t("updateSucc"));
		                        layer.close(layer.index);  
		                        window.parent.location.reload();  
							} else {
							 	alert(dataObj.errmsg);
							}
						}
					}
	            }); 
          		return false;
	        });
		}
    });
}
</script>
</body>
</html>
