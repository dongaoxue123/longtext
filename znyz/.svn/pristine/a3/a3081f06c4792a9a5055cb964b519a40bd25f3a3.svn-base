<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../../statics/plugins/layui/css/layui.css" media="all">
  
</head>
<script src="../../statics/plugins/layui/layui.js"></script>
<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
<body> 
    <div class="layui-form-item" id="button" style="margin-top: 10px;">
        <label class="layui-form-label">集团名称:</label>
        <div class="layui-input-inline">
            <input class="layui-input" id="name" name="name">
		    </div>
		    <label class="layui-form-label">集团代码:</label>
		    <div class="layui-input-inline">
		        <input class="layui-input" id="code" name="code">
		    </div>
    	<button class="layui-btn" id="search">查询</button>
    	
    	<button class="layui-btn" id="reset">重置</button>
    	
    	<button class="layui-btn" id="add">添加</button>
    </div>
<table class="layui-hide" id="groupInfo" lay-filter="groupInfo"></table>
<script type="text/html" id="barDemo">
  <!--<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>-->
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
	<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
 <script type="text/html" id="stateTpl">
  if({d.state}==0){不可用}else if({d.state}==1){可用}
</script> 
<script>
	var authToken=localStorage.getItem("authToken");
	//alert(authToken);
	var user =localStorage.getItem("user");

	if(!checkToken()){
  		alert("登录超时，请重新登录！");
 			window.top.location.href = '../../login.html';
	}

	layui.use(['form','table','laydate'], function(){
		var table = layui.table;
		var form = layui.form;
		var laydate = layui.laydate;
		var $ = layui.$;
		  //方法级渲染
		table.render({
		    elem: '#groupInfo'
		    ,url: commonIP + "api/system/group/getListPage?authToken="+authToken  //数据请求路径
		    ,parseData: function(res){ //res 即为原始返回的数据
			    return {
			    	"code": res.code, //解析接口状态
      			"msg": res.msg, //解析提示文本
      			"count": res.count, //解析数据长度
			      "data": res.errcode === '200' ? res.dataSource.list : [] //解析数据列表
			    };
  			}
		    ,cellMinWidth: 80
		    ,cols: [[
		      {type:'numbers',width:'5%'}
		      ,{field:'name', title:'名称',width:'15%'}
		      ,{field:'code', title:'集团代码',width:'15%'}
		      ,{field:'state', title:'状态',width:'13%'}
		      ,{field:'remark', title: '描述',width:'25%'}
		      ,{field:'createTime', title: '创建时间',width:'15%'}
		      ,{fixed: 'right',title: '操作', width:'10%',  align:'center', toolbar: '#barDemo'}//一个工具栏  具体请查看layui官网
		    ]]
		    ,done:function(res, page, count){    //res 接口返回的信息
		    			    	console.log(res);
			    $("[data-field = 'state']").children().each(function(){
			        if($(this).text() == '1'){
			            $(this).text("可用");
			        }else if($(this).text() == '0'){
			             $(this).text("不可用");
			        }
			    })
			    }
		    ,even: true //开启隔行背景
		    ,page: true   //开启分页
		    ,limit:20   //默认十条数据一页
		    ,limits:[10,20,30,50]  //数据分页条
		    ,id: 'testReload'
		});

		//监听工具条
		table.on('tool(groupInfo)', function(obj){
		    var data = obj.data;
		    if(obj.event === 'detail'){
		      //layer.msg('ID：'+ data.id + ' 的查看操作');
  
		    } else if(obj.event === 'del'){
	        layer.confirm('确定删除此行数据吗', function(index){
	      		  $.ajax({  
			            url: commonIP + "api/system/group/delete?authToken="+authToken,
			            type: 'POST',
									contentType: 'application/json',
									data: JSON.stringify({"id":data.id}),
	                success: function(text) {
	                	var dataObj = JSON.parse(text);
	                		if(dataObj.code == 0){
			                		layer.msg(dataObj.msg, {icon: 6});
									        obj.del();
									        layer.close(index);  
	                		}else{
	                				layer.msg(dataObj.msg, {icon: 5});
	                		}
	                }
		            });  
      		});
		    } else if(obj.event === 'edit'){
  				  var index = layer.open({
						    type: 2,
						    content: "addGroupInfo.html?id="+data.id,
						    area: ['750px', '500px'],
						    maxmin: true
						});  
		    }
	  });
		  
	  $('#add').on('click', function(){
	   		var index = layer.open({
				    type: 2,
				    content: 'addGroupInfo.html',
				    area: ['750px', '500px'],
				    maxmin: true
				});
//					layer.full(index);
	  });
		var active = {
		    reload: function(){
		      //执行重载
		      table.reload('testReload', {
		        page: {
		          curr: 1 //重新从第 1 页开始
		        }
		        ,where: {
	            	name: $("#name").val(),
	            	code: $("#code").val()
		        }
		      });
		    },
		};

		$('#search').on('click', function(){
		    active['reload'].call(this);
		});
		$('#reset').on('click', function(){
			$('#name').val("");
			$('#code').val("");
		});
	});
</script>

</body>
</html>