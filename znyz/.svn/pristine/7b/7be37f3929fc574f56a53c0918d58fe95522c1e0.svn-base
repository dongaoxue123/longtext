<!doctype html>
<html  style="height: 100%;color:#333333;background: #fff;">
<head>
	<meta charset="UTF-8" />
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" /><!--强制让文档的宽度与设备的宽度保持1:1，并且文档最大的宽度比例是1.0，且不允许用户点击屏幕放大浏览-->
	<meta content="yes" name="apple-mobile-web-app-capable" /><!--iphone设备中的safari私有meta标签，它表示：允许全屏模式浏览-->
	<meta content="black" name="apple-mobile-web-app-status-bar-style" /><!--iphone的私有标签，它指定的iphone中safari顶端的状态条的样式-->
	<meta name="format-detection" content="telephone=no" /><!--告诉设备忽略将页面中的数字识别为电话号码-->
	<meta content="false" name="twcClient" id="twcClient" /><!--判断页面是否在本地Native（本地APP）环境中-->	
	<title>账号一览</title>
	<script src="script/flexible.js" type="text/javascript" charset="utf-8"></script>
	<script src="script/flexible_css.js" type="text/javascript" charset="utf-8"></script>
	<script src="script/jquery-1.8.2.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="script/common.js" type="text/javascript" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href="iconfont/iconfont.css"/>
	<link rel="stylesheet" type="text/css" href="style/style.css"/>
</head>
<body  style="height:100%;">
		<!--<header>
			<span class="iconfont icon-arrow-left" onclick="location='set.html'"></span>
				<h1>账号一览</h1>
		</header>-->
		<main>
			<div class="btn">
				<input type="submit" name="save" id="save" value="点击创建新用户" onclick="location='adduser.html'"/>
			</div>
			
			<div class="addlist" id ="userlist">
			</div>
		</main>
		<script  type="text/javascript">
	        $(document).ready(function () {
	        	// 取得authToken
				var authToken = localStorage.getItem('authToken');
				setInit();
				$("#setFooter").addClass("active");
				if (authToken.length = 0){		
					alert("请重新登录");
					window.top.location.href = 'wxlogin.html';
					return false;
				} else {
					getUserList(authToken);
				}
	        });			
			function getUserList(authToken){
				var user = localStorage.getItem('user');
				var groupId = JSON.parse(user).groupId;
				var farmId = JSON.parse(user).farmId;
				$.ajax({
					type: "GET",
					url: commonIP + 'api/system/user/get',
					contentType: 'application/json',
					data: 'authToken='+authToken+'&groupId='+groupId+'&farmId='+farmId+'&page=0&limit=0',
					dataType:'json',// GET 请求方式需要添加dataType 设定返回数据的格式为json;
					success: function(data) {
						console.log(data)
						if (data) {
							if (data.errcode == 200) {	
								var result = '<ul><li style="font-weight:bold;"><span style="width:130px;">用户名</span><span>角色</span><span style="width:50px">状态</span></li>';
						        for (var key in data.dataSource.list){						        	
									var userName = data.dataSource.list[key].name;
									if(userName.length>5){//最多只展示五位
										userName = userName.substring(0,5)+'...';
									}
						        	//循环显示
						        	result = result+'<li><span style="width:130px">'+userName+'</span><span>管理员</span><span style="width:50px">在职</span>'+
						        			'<div class="edit" onclick="editUser(event)"><span class="iconfont icon-bianji"></span><input type="text" id="id" style="display:none" value="'+data.dataSource.list[key].id+'"/></div></li>';
						        }
						        result = result+'</ul>';
						        $('#userlist').prepend(result);
							} else {
								alert(data.errmsg);
								if(data.errcode =="10005"){
									window.top.location.href = 'wxlogin.html';
								}
							}
						}
					}
				});
			}
			function editUser(e) {//此处不用于修改，只查看。 
				var id = '';
				var targetClass = $(e.target).attr("class");
				if (targetClass == 'iconfont icon-bianji'){	
					id = $(e.target).parent().find("#id").val();
				} else if(targetClass == 'edit'){
					id = $(e.target).find("#id").val();
				}
				// 跳转页面并传输参数
				window.location.href = 'userView.html?id='+id;	
			}
		</script>
</body>
</html>