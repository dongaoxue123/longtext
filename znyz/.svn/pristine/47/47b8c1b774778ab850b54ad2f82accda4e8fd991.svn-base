
<html>
<head>
    <title>Title</title>
    <script src="../../statics/libs/jquery-1.7.2.js"></script>
    <link rel="stylesheet" href="../../statics/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../common/css/cyType.css">
    <link rel="stylesheet" href="../../statics/plugins/layui/css/layui.css" media="all">
    <script src="../../statics/plugins/layui/layui.js"></script>
    <script src="../../common/js/whole/cyLayer.js"></script>
    <script src="../../common/js/whole/utils.js"></script>
    <script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div class="layui-field-box">
    <form class="layui-form">
    	<div class="layui-form-item">
        	<label class="layui-form-label">父级名称</label>
            <div class="layui-input-block">
                <input type="text" id="parentName" name="parentName" class="layui-input" disabled>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">父级编码</label>
            <div class="layui-input-block">
                <input type="text" id="parentType" name="parentType" class="layui-input" disabled>
            </div>
        </div>
        <div class="layui-form-item">
        	<label class="layui-form-label">字典名称</label>
            <div class="layui-input-block">
                <input type="text" id="name" name="name" lay-verify="required|name" class="layui-input" placeholder="字典名称">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">排序</label>
            <div class="layui-input-block">
                <input type="text" id="sort" name="sort" lay-verify="required|sort" class="layui-input" placeholder="排序">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <textarea type="text" id="remark" name="remark" class="layui-textarea" placeholder="请输入内容"></textarea>
            </div>
        </div>
        <div class="page-footer">
            <div class="btn-list">
                <div class="btnlist">
                    <button class="layui-btn" lay-submit="" lay-filter="submit"><i class="fa fa-floppy-o">&nbsp;</i>保存</button>
                    <button class="layui-btn" onclick="$t.closeWindow();"><i class="fa fa-undo">&nbsp;</i>返回</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
	var authToken=localStorage.getItem("authToken");
	//alert(authToken);
	var user =localStorage.getItem("user");
 
    layui.use(['form','laydate'], function(){
        var form = layui.form;
        var $ = layui.$;
        var laydate = layui.laydate;
		
		if(!checkToken()){
	  		alert("登录超时，请重新登录！");
 			window.top.location.href = '../../login.html';
		}
		
		var userId = GetQueryString("id");//userId为空表示新增，否则是修改

        form.on('submit(submit)', function(res){
	        //layer.msg(JSON.stringify(res.field));
	   		$.ajax({  
	            type: 'POST',
				url: commonIP + "api/system/option/create?authToken="+authToken,
				contentType: 'application/json',
				data: JSON.stringify({
						"parentid":userId,
						"name":res.field.name,
						"sort":res.field.sort,
						"remark":res.field.remark
					}) ,
				success: function(data) {
					var dataObj = JSON.parse(data);
	//					console.log(dataObj);
	//					console.log(dataObj.errcode);
					if (dataObj) {
						if (dataObj.errcode == "200") {
						    alert("添加成功！");
		                    layer.close(layer.index);  
		                    window.parent.location.reload();  
						} else {
						    alert(dataObj.errmsg);
						}
					}
				}
	        });
	        return false;
       });
        
    	$.ajax({
		type: "GET",
		url: commonIP + 'api/system/option/getOptionParentList?authToken='+authToken+'&page=0&limit=0&id='+userId,
		parseData: function(res){ //res 即为原始返回的数据
			    return {
			    	"code": res.code, //解析接口状态
      			"msg": res.msg, //解析提示文本
      			"count": res.count, //解析数据长度
			      "data": res.dataSource.list //解析数据列表
			    };
  		},
		contentType: 'application/json',
		success: function(data) {
			var datas = JSON.parse(data);
			console.log(datas);
			if (datas.errcode == 200) {
				$("#parentName").val(datas.dataSource.list[0].name);
				$("#parentType").val(datas.dataSource.list[0].type);
			} else {
				//alert(data.errmsg);
				if(data.errcode=="10005"){
					window.top.location.href = '../../login.html';
				}
			}
		}
		});
    });

	/**
	 * 编辑功能赋值
	 */
	function BindData(userId) {

	}

</script>
</body>
</html>
